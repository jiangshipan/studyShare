package com.jsp.studyShare.controller;import com.jsp.studyShare.Service.EmailService;import com.jsp.studyShare.model.Response;import com.jsp.studyShare.utils.studyShareUtil;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.beans.factory.annotation.Value;import org.springframework.mail.SimpleMailMessage;import org.springframework.mail.javamail.JavaMailSender;import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.ResponseBody;@Controller@RequestMapping("/mail")public class MailController {    private static final Logger logger = LoggerFactory.getLogger(MailController.class);    @Autowired    private JavaMailSender jms;    @Autowired    private EmailService emailService;    @Value("${spring.mail.username}")    private String username;    @RequestMapping("/getCode")    @ResponseBody    public Response sendRegisterCode(@RequestParam("email") String email) {        try {            int registerCode = studyShareUtil.getFourRandom();            //添加到数据库            String result = emailService.addEmail(email, registerCode);            if (result != null) {                return new Response(1, result);            }            //建立邮件消息            SimpleMailMessage mainMessage = new SimpleMailMessage();            //发送者            mainMessage.setFrom(username);            //接收者            mainMessage.setTo(email);            //内容            mainMessage.setSubject("欢迎注册studyShare");            mainMessage.setText("您的注册码是:" + registerCode);            jms.send(mainMessage);            return new Response(0,"发送成功");        } catch (Exception e) {            logger.error("sendRegisterCode error:", e);            return new Response(1, "发送失败");        }    }    @RequestMapping("/checkCode")    @ResponseBody    public Response checkRegisterCode(@RequestParam("email") String email, @RequestParam("code") String code) {        try {            int result = emailService.checkCode(email, Integer.parseInt(code));            if (result == 1) {                return new Response(0, "验证成功");            } else {                return new Response(1, "验证失败");            }        } catch(Exception e) {            logger.error("checkRegisterCode:", e.getMessage());            return new Response(1, "验证失败");        }    }}